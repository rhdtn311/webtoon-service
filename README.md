# Webtoon Service
**ê°œì¸ í”„ë¡œì íŠ¸**
*2023-04 ~ (ì§„í–‰ ì¤‘)*

<br>

### ì‚¬ìš© ê¸°ìˆ 
<img  src="https://img.shields.io/badge/Java 17-FC4C02?style=for-the-badge&logo=JAVA&logoColor=white"> <img  src="https://img.shields.io/badge/SpringBoot 2.7.1-6DB33F?style=for-the-badge&logo=springboot&logoColor=white">
<img  src="https://img.shields.io/badge/Spring Data JPA 2.7.1-6DB33F?style=for-the-badge&logo=SPRING&logoColor=white">
<img  src="https://img.shields.io/badge/Querydsl 5.0.0-0769AD?style=for-the-badge&logo=&logoColor=white">
<img  src="https://img.shields.io/badge/Gradle-02303A?style=for-the-badge&logo=Gradle&logoColor=white">

<img  src="https://img.shields.io/badge/MySQL 8.0-4479A1?style=for-the-badge&logo=MySQL&logoColor=white">

<img  src="https://img.shields.io/badge/Github-181717?style=for-the-badge&logo=Github&logoColor=white"> <img  src="https://img.shields.io/badge/Github Actions-2088FF?style=for-the-badge&logo=Github Actions&logoColor=white">

<img  src="https://img.shields.io/badge/AWS EC2-FF9900?style=for-the-badge&logo=Amazon EC2&logoColor=white"> <img  src="https://img.shields.io/badge/AWS S3-569A31?style=for-the-badge&logo=Amazon S3&logoColor=white">

<br>

## ğŸ“‹ ê°œìš”
ë„¤ì´ë²„ ì›¹íˆ°, ë‹¤ìŒ ì›¹íˆ° ë“± ë‹¤ì–‘í•œ ì›¹íˆ° ì„œë¹„ìŠ¤ë¥¼ ì°¸ê³ í•˜ì—¬ ìì£¼ ì‚¬ìš©ë˜ëŠ” ì—¬ëŸ¬ APIë¥¼ ì§ì ‘ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

<br>

## ğŸ¯ ëª©í‘œ
-   ì„±ëŠ¥ì„ ê³ ë ¤í•œ ê¸°ëŠ¥ êµ¬í˜„
-   ê°€ë…ì„± ìˆëŠ” ì½”ë“œ ì‘ì„±
-   í™•ì¥ì„± ìˆëŠ” ì½”ë“œ ì‘ì„±
-   ì—¬ëŸ¬ ì›¹ ì„œë¹„ìŠ¤ì— ì¡´ì¬í•˜ëŠ” ë‹¤ì–‘í•œ ê¸°ëŠ¥ ìŠ¤ìŠ¤ë¡œ êµ¬í˜„

<br>

## ğŸ”§ ì£¼ìš” ê¸°ëŠ¥
-   íšŒì›ê°€ì…/ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
-   ì‘ê°€ ì‹ ì²­/ì‘ê°€ ì¡°íšŒ
-   ì›¹íˆ° ë“±ë¡/ìˆ˜ì •, ì—í”¼ì†Œë“œ ë“±ë¡/ìˆ˜ì •
-   ì—í”¼ì†Œë“œ ëª©ë¡ ì¡°íšŒ/ì—í”¼ì†Œë“œ ì¡°íšŒ/ì—í”¼ì†Œë“œ ìƒì„¸ ì¡°íšŒ
-   íŒ”ë¡œìš° ì¶”ê°€/ì‚­ì œ, ë³„ì  ë“±ë¡, ì¢‹ì•„ìš” ì¶”ê°€/ì‚­ì œ
-   ì›¹íˆ° ëª©ë¡ ì¡°íšŒ
    -   ì¥ë¥´ë³„ ì›¹íˆ° ëª©ë¡ ì¡°íšŒ
    -   ìµœê·¼ ë³¸ ì›¹íˆ° ëª©ë¡ ì¡°íšŒ
    -   ìƒˆë¡œ ì˜¬ë¼ì˜¨ ì—í”¼ì†Œë“œê°€ ìˆëŠ” ì›¹íˆ° ëª©ë¡ ì¡°íšŒ
    -   ì‹¤ì‹œê°„ ì¸ê¸° ì›¹íˆ° ì¡°íšŒ

<br>

## ì„œë²„ ì•„í‚¤í…ì²˜
![image](https://github.com/rhdtn311/webtoon-service/assets/68289543/ada2bdd4-06fd-411d-a02f-c18f307bfc97)

<br>

## ğŸ§ª ì´ìŠˆ ë° íŠ¸ëŸ¬ë¸”ìŠˆíŒ…
### 1. ì¡°íšŒ ì„±ëŠ¥ ê°œì„  - 1
**ìš”ì•½: ì£¼ìš” í…Œì´ë¸” 500ë§Œê°œ ë°ì´í„° ê¸°ì¤€ 0.86ì´ˆ -> 0.02ì´ˆë¡œ ì¡°íšŒ ì„±ëŠ¥ ê°œì„ **

<details>
<summary> <b> í™•ì¸ </b> </summary>
<div markdown="1">       

'ì¥ë¥´ë³„ ì›¹íˆ° ëª©ë¡ ì¡°íšŒ' ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ì€ ìš”êµ¬ì‚¬í•­ì„ ê°€ì§‘ë‹ˆë‹¤.
1. ì‚¬ìš©ìê°€ ìš”êµ¬í•˜ëŠ” ì¥ë¥´ì— ì†í•˜ëŠ” ì›¹íˆ° ëª©ë¡ì„ í•„í„°ë§í•œë‹¤.
2. ì›¹íˆ°ì´ 3ì¼ ì´ë‚´ ìƒì„±ë˜ì—ˆë‹¤ë©´ ê°€ì¥ ìœ„ì— ì¶œë ¥í•œë‹¤.
3. ì¡°íšŒìˆ˜ê°€ ë†’ì€ ìˆœì„œëŒ€ë¡œ ë‚˜ì—´í•œë‹¤.
	3-1. ì¡°íšŒìˆ˜ëŠ” ì›¹íˆ°ì˜ ê°€ì¥ ìµœê·¼ ì—í”¼ì†Œë“œì˜ ì¡°íšŒìˆ˜ë§Œ ê³„ì‚°í•œë‹¤.

ìœ„ ìš”êµ¬ì‚¬í•­ì„ ë°”íƒ•ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ì¡°íšŒ ì¿¼ë¦¬ë¥¼ ë„ì¶œí–ˆìŠµë‹ˆë‹¤.
```sql
SELECT c.id, c.name, a.author_name, t.image_url, c.created_at > "..." 
FROM comic c 
LEFT JOIN episode e ON e.comic_id = c.id 
	AND e.episode_number = 
				(SELECT  MAX(e2.episode_number) 
				 FROM episode e2 
				 WHERE e2.comic_id = c.id) 
LEFT JOIN  view v ON e.id = v.episode_id 
JOIN author a ON a.id = c.author_id 
LEFT JOIN thumbnail t ON c.id = t.comic_id AND t.thumbnail_type = "MAIN" 
WHERE c.genre = "ACTION" 
GROUP  BY c.id, t.image_url 
ORDER  BY (IF(DATE_SUB(NOW(), INTERVAL  3  DAY) <= c.created_at, 1, 2)), COUNT(v.id) DESC;
```
ì›¹íˆ°ì˜ ì¡°íšŒìˆ˜ë¥¼ ê³„ì‚°í•˜ê¸° ìœ„í•´ íŠ¹ì • ì›¹íˆ°ì˜ ìµœê·¼ ì—í”¼ì†Œë“œë¥¼ ì°¾ê³ , ì¡°íšŒìˆ˜ í…Œì´ë¸”ì—ì„œ í•´ë‹¹ ì—í”¼ì†Œë“œì˜ idì™€ ì¼ì¹˜í•˜ëŠ” ë¡œìš° ìˆ˜ë¥¼ count í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤. 

<br>

#### ë¬¸ì œì 
ì´ë•Œ ì£¼ìš” í…Œì´ë¸”ì¸ ì¡°íšŒìˆ˜ í…Œì´ë¸”ì— ë°ì´í„°ê°€ 500ë§Œê°œ ìˆì„ ë•Œ ìœ„ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í–ˆë”ë‹ˆ ì•½ 0.86ì´ˆì˜ ì‹œê°„ì´ ì†Œìš”ë˜ì—ˆìŠµë‹ˆë‹¤.

![](https://blog.kakaocdn.net/dn/VFAbc/btseR9oliRh/4GTfRkGSKkvMRkDKtk7GgK/img.png)


'ì¥ë¥´ë³„ ì›¹íˆ° ëª©ë¡ ì¡°íšŒ' ê¸°ëŠ¥ì€ ë©”ì¸ í˜ì´ì§€ì— ì‚¬ìš©ìê°€ ì ‘ì†í•  ë•Œë§ˆë‹¤ í˜¸ì¶œë˜ëŠ” APIì´ê¸° ë•Œë¬¸ì— í˜¸ì¶œ ìˆ˜ê°€ ë¹ˆë²ˆí•˜ë‹¤ê³  íŒë‹¨í–ˆê³  ë§¤ APIë¥¼ í˜¸ì¶œí•  ë•Œë§ˆë‹¤ ë‹¨ìˆœ ì¿¼ë¦¬ ìˆ˜í–‰ ì‹œê°„ë§Œ 0.87ì´ˆ ê±¸ë¦¬ëŠ” ê²ƒì€ ì„±ëŠ¥ìƒ ì¢‹ì§€ ì•Šë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì¿¼ë¦¬ íŠœë‹ì„ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.

#### í•´ê²° ê³¼ì •
ìš°ì„  ì¿¼ë¦¬ ì‹¤í–‰ê³„íšì„ ë¶„ì„í–ˆìŠµë‹ˆë‹¤. 
![](https://blog.kakaocdn.net/dn/dIMoMK/btseNsQzd63/xohVquqVygzJgz721hvCu1/img.png)


ì´ë•Œ `select_type`ì— `DEPENDENT SUBQUERY`ê°€ ì¡´ì¬í–ˆê³ , ì´ë¥¼ ê²€ìƒ‰í•´ë³¸ ê²°ê³¼ **ìƒê´€ ì„œë¸Œì¿¼ë¦¬**ë¼ëŠ” ê²ƒì„ ì•Œê²Œë˜ì—ˆìŠµë‹ˆë‹¤. ìƒê´€ ì„œë¸Œì¿¼ë¦¬ëŠ” ìƒìœ„ ì¿¼ë¦¬ ê²°ê³¼ì— ì˜ì¡´í•˜ì—¬, ìƒìœ„ ì¿¼ë¦¬ì˜ ë¡œìš° í•˜ë‚˜ ë‹¹ ì„œë¸Œì¿¼ë¦¬ë¥¼ í•œ ë²ˆì”© ì‹¤í–‰í•˜ëŠ” ì¿¼ë¦¬ë¡œ, ìœ„ ì¿¼ë¦¬ì—ì„œëŠ” ìƒìœ„ ì¿¼ë¦¬ì˜ ëª¨ë“  ë¡œìš°ì— ëŒ€í•´ `c.id`ë¥¼ ì„œë¸Œì¿¼ë¦¬ì˜ ì¡°ê±´ì ˆë¡œ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— ì¡°íšŒëœ ëª¨ë“  ë¡œìš° ìˆ˜ë§Œí¼ ì„œë¸Œì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ì–´ ì¡°íšŒ ì„±ëŠ¥ì´ ë–¨ì–´ì§€ê²Œ ëœ ê²ƒì…ë‹ˆë‹¤.

#### í•´ê²°
ê²°ë¡ ì ìœ¼ë¡œ `in`ì ˆì„ ì‚¬ìš©í•˜ì—¬ ì¿¼ë¦¬ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ê°œì„ í•˜ì˜€ìŠµë‹ˆë‹¤.
```sql
SELECT c.id, c.name, a.author_name, t.image_url, c.created_at > "..." 
FROM comic c 
LEFT  JOIN episode e ON e.comic_id = c.id 
		AND (e.comic_id, e.episode_number) in (SELECT e2.comic_id, max(e2.episode_number) 
											   FROM episode e2 
											   GROUP  BY e2.comic_id);
LEFT JOIN  view v ON e.id = v.episode_id 
JOIN author a ON a.id = c.author_id 
LEFT JOIN thumbnail t ON c.id = t.comic_id AND t.thumbnail_type = "MAIN" 
WHERE c.genre = "ACTION" 
GROUP  BY c.id, t.image_url 
ORDER  BY (IF(DATE_SUB(NOW(), INTERVAL  3  DAY) <= c.created_at, 1, 2)), COUNT(v.id) DESC;
```
ìœ„ ì¿¼ë¦¬ëŠ” ì´ì „ ì¿¼ë¦¬ì™€ ë‹¬ë¦¬ ìƒìœ„ ì¿¼ë¦¬ì˜ ê²°ê³¼ì— ìƒê´€ì—†ì´ ì„œë¸Œì¿¼ë¦¬ ìì²´ë¡œ ì‹¤í–‰ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— ë”± í•œ ë²ˆë§Œ ì‹¤í–‰ë©ë‹ˆë‹¤. 

![](https://blog.kakaocdn.net/dn/bptHr2/btseQECApF4/DgZsjnoRC4EK4SnVdqBFck/img.png)

ê°™ì€ ì¡°ê±´ìœ¼ë¡œ ì¡°íšŒ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•œ ê²°ê³¼ 0.07ì´ˆë¡œ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤.

#### ì¶”ê°€
![](https://blog.kakaocdn.net/dn/cegDe0/btseRW3Pzel/QHyfK85hRuMGooHutHa21K/img.png)

ì¶”ê°€ì ìœ¼ë¡œ ì´ë¥¼ ë” ê°œì„ í•˜ê³ ì ì‹¤í–‰ê³„íšì„ í™•ì¸í•˜ì˜€ê³  `in`ì ˆì„ ê²€ì‚¬í•  ë•Œ ì¸ë±ìŠ¤ë¥¼ ì ì ˆíˆ ì‚¬ìš©í•˜ì§€ ëª»í•˜ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ `(e.comic_id, e.episode_number)` ë³µí•©ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ì˜€ìŠµë‹ˆë‹¤.
```sql
create index comic_id_AND_episode_number on episode (comic_id, episode_number);
```
![](https://blog.kakaocdn.net/dn/cavqz8/btseQkqPOC8/xj3L2fUEFdhltCtqYuQlXK/img.png)

ë‹¤ì‹œ ì‹¤í–‰ê³„íšì„ ë¶„ì„í•´ë³¸ ê²°ê³¼ ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” ê²ƒì„ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤.
![](https://blog.kakaocdn.net/dn/bi9bLV/btseTgtXqz9/12nmm7wWWI1ANbd7Sc4h21/img.png)

ì¿¼ë¦¬ ì„±ëŠ¥ ë˜í•œ 0.02ì´ˆë¡œ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤.

</div>
</details>




<br>

### 2. ì¡°íšŒ ì„±ëŠ¥ ê°œì„  - 2
**ìš”ì•½: ì£¼ìš” í…Œì´ë¸” 500ë§Œê°œ ë°ì´í„° ê¸°ì¤€ 5ì´ˆ -> 0.001ì´ˆë¡œ ì¡°íšŒ ì„±ëŠ¥ ê°œì„ **
<details>
<summary> <b> í™•ì¸ </b></summary>
<div markdown="1">
'ì‹¤ì‹œê°„ ì¸ê¸° ì›¹íˆ° ëª©ë¡ ì¡°íšŒ' ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ì€ ìš”êµ¬ì‚¬í•­ì„ ê°€ì§‘ë‹ˆë‹¤.
1. í•˜ë£¨ 24ì‹œê°„ì„ 0ì‹œ~2ì‹œ, 2ì‹œ~4ì‹œ, ... 22ì‹œ~24ì‹œì™€ ê°™ì´ 2ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ë‚˜ëˆ•ë‹ˆë‹¤.
2. í˜„ì¬ ì‹œê°„ê³¼ ê°€ì¥ ê°€ê¹Œìš´ ì´ì „ì˜ 2ì‹œê°„ ê°„ê²© ë™ì•ˆ ì¡°íšŒìˆ˜ê°€ ê°€ì¥ ë†’ì€ ì›¹íˆ° ìˆœì„œëŒ€ë¡œ ì •ë ¬í•©ë‹ˆë‹¤.

ë§Œì•½, í˜„ì¬ ì‹œê°„ì´ ì˜¤ì „ 3ì‹œë¼ë©´ 0ì‹œ~2ì‹œ ë™ì•ˆ ì¡°íšŒìˆ˜ê°€ ê°€ì¥ ë†’ì€ ì›¹íˆ° ìˆœì„œëŒ€ë¡œ ì •ë ¬í•©ë‹ˆë‹¤.

ìœ„ ìš”êµ¬ì‚¬í•­ì„ ë°”íƒ•ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ì¡°íšŒ ì¿¼ë¦¬ë¥¼ ë„ì¶œí–ˆìŠµë‹ˆë‹¤.
```sql
SELECT comic.id, comic.name, author.author_name, thumbnail.image_url, COUNT(view.id) 
FROM  view  
INNER  JOIN episode ON view.episode_id = episode.id 
INNER  JOIN comic ON episode.comic_id = comic.id 
INNER  JOIN author ON comic.author_id = author.id 
INNER  JOIN thumbnail ON comic.id = thumbnail.comic_id 
	AND thumbnail.thumbnail_type = "SMALL" 
WHERE view.last_access_time BETWEEN 'yyyy-MM-dd HH:mm:SS' AND 'yyyy-MM-dd HH:mm:SS'  
GROUP  BY comic.id, thumbnail.image_url 
ORDER  BY  COUNT(view.id) 
DESC LIMIT 10;
```
2ì‹œê°„ë™ì•ˆ ì›¹íˆ°, ì—í”¼ì†Œë“œ, ì¡°íšŒ í…Œì´ë¸”ì„ ì¡°ì¸í•˜ì—¬ ì›¹íˆ° idë¥¼ ê¸°ì¤€ìœ¼ë¡œ group by í›„ countí•˜ì—¬ ì›¹íˆ° ë³„ ì¡°íšŒìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤. ê·¸ë¦¬ê³  ì¡°íšŒìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ìƒìœ„ 10ê°œë§Œ ì¡°íšŒí•©ë‹ˆë‹¤.

#### ë¬¸ì œì 
![](https://blog.kakaocdn.net/dn/lnjd7/btsf59gIdMl/6sCH6J1DMPRAYeWWdFAbjk/img.png)

ì´ë•Œ ì£¼ìš” í…Œì´ë¸”ì¸ ì¡°íšŒ í…Œì´ë¸”ì— ë°ì´í„°ê°€ 500ë§Œê°œ ìˆì„ ë•Œ ìœ„ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í–ˆë”ë‹ˆ ì•½ 5ì´ˆì˜ ì‹œê°„ì´ ì†Œìš”ë˜ì—ˆìŠµë‹ˆë‹¤.

![](https://blog.kakaocdn.net/dn/dwu2s0/btsf2pd47pO/STVbvikM3b0Ky6D0t7blG1/img.png)

ì‹¤í–‰ ê³„íšì„ ì‚´í´ë³´ë‹ˆ, ì•½ 500ë§Œê°œì˜ ë°ì´í„°ê°€ ìˆëŠ” ì¡°íšŒ í…Œì´ë¸”ì„ FULL TABLE SCAN í•˜ê¸° ë•Œë¬¸ì´ì—ˆìŠµë‹ˆë‹¤. ì¡°íšŒ ì¡°ê±´ì¸ `last_access_time` ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ ì¡°íšŒ ì„±ëŠ¥ì„ ë†’ì¼ ìˆ˜ë„ ìˆì—ˆì§€ë§Œ ì¡°íšŒ í…Œì´ë¸” íŠ¹ì„± ìƒ ë°ì´í„°ì˜ ì‚½ì…, ìˆ˜ì •ì´ ë§ì€ í…Œì´ë¸”ì´ê¸° ë•Œë¬¸ì— ì¸ë±ìŠ¤ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì€ ì˜¤íˆë ¤ ì„±ëŠ¥ ìƒ ì¢‹ì§€ ì•Šì„ ê²ƒì´ë¼ íŒë‹¨í–ˆìŠµë‹ˆë‹¤.

#### í•´ê²°
ê³ ë ¤í–ˆë˜ í•´ê²° ë°©ë²•ì€ ë‘ ê°€ì§€ì…ë‹ˆë‹¤.
1. ìºì‹œ ì ìš©
2. ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ íŠ¹ì • ì‹œê°„ë§ˆë‹¤ ì‹¤ì‹œê°„ ì¸ê¸° ì›¹íˆ° ëª©ë¡ ê³„ì‚°

ì €ëŠ” 2ë²ˆ ë°©ë²•ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤. ì´ìœ ëŠ” ê³¼ê±°ì˜ ì‹¤ì‹œê°„ ì¸ê¸° ì›¹íˆ° ì´ë ¥ì„ ê´€ë¦¬í•˜ê¸° í¸í•˜ê³  ìºì‹œë¥¼ ì‚¬ìš©í•˜ë”ë¼ë„ ì²˜ìŒ APIë¥¼ í˜¸ì¶œí•˜ëŠ” ì‚¬ëŒí•œí…ŒëŠ” ë§ì€ ì‹œê°„ì´ ì†Œìš”ë  ê²ƒì´ë¼ íŒë‹¨í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. 

ë”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì´ ê¸°ëŠ¥ êµ¬í˜„ ê³¼ì •ì„ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.
1. 'ì‹¤ì‹œê°„ ì¸ê¸° ì›¹íˆ° ëª©ë¡'ì„ ì €ì¥í•˜ëŠ” í…Œì´ë¸”ì„ ìƒì„±í•œë‹¤.
2. 2ì‹œê°„ì— í•œ ë²ˆ ì‹¤ì‹œê°„ ì¸ê¸° ì›¹íˆ° ëª©ë¡ì„ ê³„ì‚°í•˜ì—¬ í…Œì´ë¸”ì— 10ê°œì˜ ë°ì´í„°ë¥¼ ì‚½ì…í•œë‹¤.
3. ì‹¤ì‹œê°„ ì¸ê¸° ì›¹íˆ° ëª©ë¡ ì¡°íšŒ APIë¥¼ í˜¸ì¶œí•˜ë©´ í•´ë‹¹ í…Œì´ë¸”ì—ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒí•œë‹¤.

ìœ„ì²˜ëŸ¼ êµ¬í˜„ ë°©ì‹ì„ ë³€ê²½í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¥ì ì´ ìˆìŠµë‹ˆë‹¤.

1. 2ì‹œê°„ë‹¹ 10ê°œ, í•˜ë£¨ì— 120ê°œì˜ ë°ì´í„°ë§Œ ì‚½ì…ë˜ê¸° ë•Œë¬¸ì— ì¡°íšŒ í…Œì´ë¸”ë³´ë‹¤ ë°ì´í„°ì˜ ìˆ˜ê°€ í˜„ì €íˆ ì ìŠµë‹ˆë‹¤. -> ì¡°íšŒ ì†ë„ ì¦ê°€
2. ë°ì´í„° ë³€ê²½ì´ ì ì€ í…Œì´ë¸”ì´ê¸° ë•Œë¬¸ì— ì¸ë±ìŠ¤ë¥¼ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. -> ì¡°íšŒ ì†ë„ ì¦ê°€
3. ê³¼ê±°ì— ì¸ê¸° ìˆì—ˆë˜ ì›¹íˆ° ë˜í•œ ë¹ ë¥´ê²Œ ì¡°íšŒí•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

<br>

![](https://blog.kakaocdn.net/dn/bSL5aI/btsgaMyEXI0/Cp0DVHkuqoJLOKHYVnDtok/img.png)

'ì‹¤ì‹œê°„ ì¸ê¸° ì›¹íˆ° ëª©ë¡' í…Œì´ë¸”ì„ ìƒì„±í–ˆìŠµë‹ˆë‹¤.
![](https://blog.kakaocdn.net/dn/nMP3a/btsgbIwdqqo/3tbNzm9RcEvNWGkeGdJNQ0/img.png)

ìŠ¤í”„ë§ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ 2ì‹œê°„ì— í•œ ë²ˆì”© ì‹¤ì‹œê°„ ì¸ê¸° ì›¹íˆ° ëª©ë¡ í…Œì´ë¸”ì— 2ì‹œê°„ë™ì•ˆ ì¡°íšŒìˆ˜ê°€ ê°€ì¥ ë†’ì€ 10ê°œì˜ ì›¹íˆ° ëª©ë¡ì„ ì‚½ì…í•˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤. 

### ê²°ê³¼
ì•½ 10ë…„ê°„ ì‹¤ì‹œê°„ ì¸ê¸° ì›¹íˆ° ëª©ë¡ ë°ì´í„°ê°€ ìŒ“ì˜€ì„ ë•Œì˜ ë°ì´í„°ì¸ 45ë§Œê°œì˜ ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ ì¸ê¸° ì›¹íˆ° í…Œì´ë¸”ì— ë„£ê³  ì‹¤ì‹œê°„ ì¸ê¸° ì›¹íˆ° ëª©ë¡ì„ ì¡°íšŒí•˜ì˜€ìŠµë‹ˆë‹¤. 
```sql
SELECT comic.id, realtime_comic_ranking.ranks, comic.name, author.author_name, thumbnail.image_url, realtime_comic_ranking.views 
FROM realtime_comic_ranking 
INNER  JOIN comic ON realtime_comic_ranking.comic_id = comic.id 
INNER  JOIN author ON comic.author_id = author.id 
LEFT  OUTER  JOIN thumbnail ON comic.id = thumbnail.comic_id AND 
							   thumbnail.thumbnail_type =  'SMALL'  
WHERE realtime_comic_ranking.record_date =  '2023-05-16'  AND 
	  realtime_comic_ranking.record_time =  'HOUR_00_02'  
ORDER  BY `ranks` ASC;
```
![](https://blog.kakaocdn.net/dn/cAwHRM/btsf59HUb3K/Eo7b75eYIYqKKD4HZXDBRk/img.png)

ê²°ê³¼ëŠ” ì•½ 0.14ì´ˆì˜ ì‹œê°„ì´ ì†Œìš”ë˜ì—ˆìŠµë‹ˆë‹¤.
```sql
ALTER  TABLE `web_comics`.`realtime_comic_ranking` 
ADD INDEX `record_date_AND_record_time_index` (`record_date` ASC, `record_time` ASC) VISIBLE;;
```
ì¶”ê°€ì ìœ¼ë¡œ ì¡°ê±´ì ˆì— ì‚¬ìš©ë˜ëŠ” ì»¬ëŸ¼ì— ë³µí•© ì¸ë±ìŠ¤ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

![](https://blog.kakaocdn.net/dn/NzDqx/btsgchZr3Lo/WzTJMnNO36BOGHxkKkPO81/img.png)

ê²°ê³¼ì ìœ¼ë¡œ 0.00nì´ˆë¡œ ì¡°íšŒ ì‹œê°„ì´ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤.
</div>
</details>
<br>

### 3. ì—¬ëŸ¬ ë‹¨ì¼ insert ì¿¼ë¦¬ -> bulk insertë¡œ í•œ ë²ˆì— ì²˜ë¦¬í•˜ê¸°
**ìš”ì•½: ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ì¡°íšŒ ì‹œ ë³´ë‚´ëŠ” insert, update ì¿¼ë¦¬ë¥¼ ì¸ë©”ëª¨ë¦¬ì— ëª¨ì•„ í•œ ë²ˆì— insert í•˜ì—¬ DB ì ‘ê·¼ì„ ìµœì†Œí™”**
<details>
<summary> <b> í™•ì¸ </b></summary>
<div markdown="1">

#### ë¬¸ì œì 
![](https://file.notion.so/f/s/a73fe63b-fa41-4f6c-9003-7cc6f9075d6e/h.png?id=35e282d9-2a92-4ce0-abc3-b7f00bf8add9&table=block&spaceId=92733449-5700-47a6-a223-50f1b43b5171&expirationTimestamp=1690344000000&signature=qdJUMceHvLllLx1Rvhla63zBYy4K5XgS2oQCmhTazvg&downloadName=h.png)

ì‚¬ìš©ìê°€ ì—í”¼ì†Œë“œë¥¼ ì¡°íšŒí•˜ë©´ ì¡°íšŒ ë°ì´í„°ê°€ ê°±ì‹ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì€ ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤.
1. í•´ë‹¹ ì—í”¼ì†Œë“œë¥¼ ì´ì „ì— ì¡°íšŒí•œ ì  ìˆëŠ”ì§€ ì¡°íšŒ
2. ì—í”¼ì†Œë“œì— ëŒ€í•œ ì‚¬ìš©ìì˜ ì¡°íšŒ ë°ì´í„°ë¥¼ insert/update <br>
  2-1. ì¡°íšŒí•œ ì  ìˆë‹¤ë©´ ê¸°ì¡´ ì¡°íšŒ ë°ì´í„°ë¥¼ í˜„ì¬ ì‹œê°„ìœ¼ë¡œ update <br>
  2-2. ì¡°íšŒí•œ ì  ì—†ë‹¤ë©´ ìƒˆë¡œìš´ ì¡°íšŒ ë°ì´í„°ë¥¼ ì¡°íšŒ í…Œì´ë¸”ì— insert

ì´ë•Œ, ë§Œì•½ 10ëª…ì˜ ì‚¬ìš©ìê°€ íŠ¹ì • ì›¹íˆ°ì˜ ì—í”¼ì†Œë“œë¥¼ ì¡°íšŒí•œë‹¤ë©´ 10ê°œì˜ insert ì¿¼ë¦¬ê°€ ë‚˜ê°€ê³ , ì—í”¼ì†Œë“œë¥¼ ì¡°íšŒí•œ ì‚¬ìš©ìê°€ 1000ëª…ì´ë¼ë©´ 1000ê°œì˜ insert ì¿¼ë¦¬ê°€ ë‚˜ê°‘ë‹ˆë‹¤. ì´ë ‡ê²Œ DB ì ‘ê·¼ì´ ë§ì•„ ì§ˆ ìˆ˜ë¡ ì‚¬ìš©ë˜ëŠ” ë¹„ìš©ë„ ê·¸ë§Œí¼ ì¦ê°€í•˜ê²Œ ë©ë‹ˆë‹¤. ë”°ë¼ì„œ insert/update ì¿¼ë¦¬ë¥¼ ì¤„ì´ê³ ì í–ˆìŠµë‹ˆë‹¤.

#### í•´ê²°
![](https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fe8c6b5ab-3528-474d-ad47-047e0fe319f8%2Fhs.svg?id=2cbc26ea-8dc6-4e9f-b33a-0d73300e3767&table=block&spaceId=92733449-5700-47a6-a223-50f1b43b5171&userId=660ca7a2-7a30-495f-b85f-55faf8b7a8d8&cache=v2)

1.  ì‚¬ìš©ìê°€ ì—í”¼ì†Œë“œë¥¼ ì¡°íšŒí•œë‹¤.
2.  ì‚¬ìš©ìê°€ í•´ë‹¹ ì—í”¼ì†Œë“œë¥¼ ì´ì „ì— ì¡°íšŒí•œ ì  ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.
3.  ì—í”¼ì†Œë“œ ì¡°íšŒ ì—”í‹°í‹°ë¥¼ ìƒì„±í•˜ì—¬ ë©”ëª¨ë¦¬ì— ì €ì¥í•œë‹¤.
4.  ë©”ëª¨ë¦¬ì— ì¼ì • ê°œìˆ˜ë§Œí¼ ì¡°íšŒ ë°ì´í„°ê°€ ìŒ“ì˜€ë‹¤ë©´ í•œ ë²ˆì— bulk insertí•œë‹¤.

ìœ„ì™€ ê°™ì´ ì‚¬ìš©ìì˜ ì—í”¼ì†Œë“œì— ëŒ€í•œ ì¡°íšŒ ì •ë³´ë¥¼ ë°”ë¡œ DBì— ë³´ë‚´ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë©”ëª¨ë¦¬ì— ìŒ“ì•„ë‘ê³ , ì¼ì • ê°œìˆ˜ê°€ ìŒ“ì´ë©´ DBì— í•œ ë²ˆì— insert/updateí•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

![](https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fcd060f3b-0bd2-4af5-a285-9c8fc6499f55%2Fhoh.svg?id=22ea0d48-01e8-46cd-b952-ae9c13af38fd&table=block&spaceId=92733449-5700-47a6-a223-50f1b43b5171&userId=660ca7a2-7a30-495f-b85f-55faf8b7a8d8&cache=v2)

ë©”ëª¨ë¦¬ì— ì €ì¥í•  ë•Œ ì‚¬ìš©í•  Map ìë£Œêµ¬ì¡°ì˜ í˜•íƒœëŠ” ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤. HashMap ë‚´ë¶€ì— ConcurrentHashMapì´ ìˆëŠ” í˜•íƒœì¸ë°(insert, updateëŠ” ê°ê° Map ìë£Œêµ¬ì¡°ì…ë‹ˆë‹¤.), insert Mapì€ ì‚¬ìš©ìê°€ ì´ì „ì— ì¡°íšŒí•œì  ì—†ëŠ” ì—í”¼ì†Œë“œì´ê¸° ë•Œë¬¸ì— ìƒˆë¡œ ìƒì„±í•´ì•¼ í•˜ëŠ” ì¡°íšŒ ë°ì´í„°ë¥¼ ë‹´ê³ ìˆê³ , update Mapì€ ì‚¬ìš©ìê°€ ì´ì „ì— ì¡°íšŒí•œì  ìˆëŠ” ì—í”¼ì†Œë“œì´ê¸° ë•Œë¬¸ì— ìˆ˜ì •í•´ì¤˜ì•¼ í•˜ëŠ” ì¡°íšŒ ë°ì´í„°ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ insertì™€ update Mapìœ¼ë¡œ ë‚˜ëˆˆ ì´ìœ ëŠ” bulk insertì™€ bulk updateì˜ SQLë¬¸ì´ ì¡°ê¸ˆ ë‹¤ë¥´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

#### ê²°ê³¼
![](https://file.notion.so/f/s/e432cd3a-cd51-45f2-a662-1ccd25ea2d30/Untitled.png?id=e0553a65-e5bf-47b5-ae5a-f60b94859d56&table=block&spaceId=92733449-5700-47a6-a223-50f1b43b5171&expirationTimestamp=1690344000000&signature=MGRQrWqdMaFraFJbHzw1oIGCnMkcZIBLrMKJPKjCrho&downloadName=Untitled.png)

ìš°ì„  ë©”ëª¨ë¦¬ì— ë°ì´í„°ê°€ 5000ê°œ ìŒ“ì˜€ì„ ë•Œ DBì— ë°˜ì˜í•˜ë„ë¡ ë¡œì§ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ 1ì´ˆ ë™ì•ˆ 5000ëª…ì˜ ì„œë¡œë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì—í”¼ì†Œë“œë¥¼ ì¡°íšŒí•˜ëŠ” ìš”ì²­ì„ ë³´ëƒˆìŠµë‹ˆë‹¤.

![](https://www.notion.so/image/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4ad0bfb0-b6fa-480b-bbb2-fbeeccc28384%2FUntitled.png?id=7cb423a5-8b81-40eb-a084-f61f76f1e2d2&table=block&spaceId=92733449-5700-47a6-a223-50f1b43b5171&width=2000&userId=660ca7a2-7a30-495f-b85f-55faf8b7a8d8&cache=v2)

ê¸°ì¡´ì—ëŠ” 5000ê°œì˜ insert ì¿¼ë¦¬ê°€ ë‚˜ê°”ì§€ë§Œ, 1ë²ˆì˜ insert ì¿¼ë¦¬ë§Œ ë‚˜ê°€ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

![](https://file.notion.so/f/s/bb2d886a-5904-45b7-9ae8-ec752a4a5d0e/Untitled.png?id=ac6e1f5a-f35c-4cd0-8ee5-3906a356cfba&table=block&spaceId=92733449-5700-47a6-a223-50f1b43b5171&expirationTimestamp=1690351200000&signature=6QjgJfGOZc24wqCCBN_wqogQHfTaJOQCuoswsjmhlnU&downloadName=Untitled.png)

ë°ì´í„°ë„ ì •ìƒì ìœ¼ë¡œ 5000ê°œê°€ ì‚½ì…ëœ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
</div>
</details>
<br>

### 4. Spring Eventsë¡œ ë‚­ë¹„ë˜ëŠ” S3 ì €ì¥ì†Œ ê´€ë¦¬í•˜ê¸°
**ìš”ì•½: S3 ì €ì¥ì†Œì— ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ê°€ ì—…ë¡œë“œë˜ëŠ” ê²½ìš° í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ëŠ” ì´ë²¤íŠ¸ë¥¼ í˜¸ì¶œí•˜ì—¬ ì €ì¥ê³µê°„ íš¨ìœ¨í™”**

<details>
<summary> <b> í™•ì¸ </b></summary>
<div markdown="1">
	
#### ë¬¸ì œ
![](https://blog.kakaocdn.net/dn/deiTX5/btsbQ2Mf9dj/kP9eCVKM1JYXIki0UJac91/img.jpg)

ì›¹íˆ° ì €ì¥ APIë¥¼ í˜¸ì¶œí•˜ë©´ íë¦„ì€ ìœ„ì™€ ê°™ìŠµë‹ˆë‹¤.
ì—¬ê¸°ì„œ 2, 3ë²ˆ ê³¼ì •ì„ ë³´ë©´ ì¸ë„¤ì¼ ì´ë¯¸ì§€ë¥¼ S3ì— ì—…ë¡œë“œí•˜ê³  URLì„ DBì— ì €ì¥í•©ë‹ˆë‹¤. ì´ ë•Œ, 2ë²ˆ ê³¼ì • ì´í›„ì— ì˜ˆì™¸ê°€ ë°œìƒí•˜ì—¬ íŠ¸ëœì­ì…˜ì´ ë¡¤ë°±ë˜ë©´ DBì— ì›¹íˆ°ì— ëŒ€í•œ ì •ë³´ëŠ” ì €ì¥ë˜ì§€ ì•Šì§€ë§Œ, S3ì—ëŠ” ì—¬ì „íˆ ì¸ë„¤ì¼ ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
ì¦‰, ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ê°€ ì €ì¥ ê³µê°„ì„ ì°¨ì§€í•˜ê³  ìˆëŠ” ê²ƒì…ë‹ˆë‹¤.

#### í•´ê²°
ìŠ¤í”„ë§ì—ì„œ ì œê³µí•˜ëŠ” `@TransactionalEventListener`ì„ ì‚¬ìš©í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í•˜ì˜€ìŠµë‹ˆë‹¤. í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì—ëŠ” `phase`ë¼ëŠ” ì˜µì…˜ì´ ì¡´ì¬í•˜ëŠ”ë°, ì´ ì˜µì…˜ ê°’ì„ ì„¤ì •í•˜ë©´ íŠ¸ëœì­ì…˜ì´ ë¡¤ë°±ë˜ì—ˆì„ ë•Œ ì´ë²¤íŠ¸ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```java
@Transactional  
public  void  createComic(ComicCreateRequest comicCreateRequest, String loginId) { 
	// ì›¹íˆ° ì €ì¥ API ë¡œì§ (ìƒëµ)
	
	applicationEventPublisher.publishEvent(new FileDeleteEvent(thumbnailImageUrl)); 
}
```
ìœ„ì™€ ê°™ì´ ì›¹íˆ° ì €ì¥ APIì—ì„œ `FileDeleteEvent`ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
```java
@Component  
@RequiredArgsConstructor  
public  class  FileEventListener { 

private  final FileStorage fileStorage; 

@Async
@TransactionalEventListener(phase = TransactionPhase.AFTER_ROLLBACK)  
public  void  deleteFile(FileDeleteEvent fileDeleteEvent) { 
	fileStorage.delete(fileDeleteEvent.getKey(), ImageFileType.COMIC_THUMBNAIL); 
	} 
}
```
ê·¸ë¦¬ê³  ì›¹íˆ° ì €ì¥ API ë¡œì§ì´ ìˆ˜í–‰ë  ë•Œë§ˆë‹¤ ì´ë²¤íŠ¸ë¥¼ í˜¸ì¶œí•˜ëŠ”ê²Œ ì•„ë‹ˆë¼ `TransactionPhase.AFTER_ROLLBACK`ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ íŠ¸ëœì­ì…˜ì´ ë¡¤ë°±ë˜ëŠ” ê²½ìš°ì—ë§Œ S3ì— ì €ì¥ëœ ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ëŠ” ì´ë²¤íŠ¸ê°€ í˜¸ì¶œë©ë‹ˆë‹¤.
ì¶”ê°€ì ìœ¼ë¡œ í•´ë‹¹ ì´ë²¤íŠ¸ì— `@Async` ì–´ë…¸í…Œì´ì…˜ì„ ì ìš©í•¨ìœ¼ë¡œì¨ ë¹„ë™ê¸°ë¡œ í˜¸ì¶œë˜ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤. ë”°ë¼ì„œ ì‚¬ìš©ìëŠ” ì›¹íˆ° ì €ì¥ì— ì‹¤íŒ¨í•˜ë”ë¼ë„ S3ì— ì €ì¥ëœ ì´ë¯¸ì§€ë¥¼ ì‚­ì œí•˜ëŠ” ì‹œê°„ê¹Œì§€ ê¸°ë‹¤ë¦´ í•„ìš”ê°€ ì—†ê²Œë©ë‹ˆë‹¤.
</div>
</details>
<br>

### 5. ì¼ê´€ì„± ìˆëŠ” ì˜ˆì™¸ ì‘ë‹µ 
**ìš”ì•½: ì˜ˆì™¸ ë°œìƒ ì‹œ ì¼ê´€ì„± ìˆëŠ” í˜•ì‹ì˜ ErrorResponseë¥¼ ìƒì„±í•˜ì—¬ ë°˜í™˜**

<details>
<summary> <b> í™•ì¸ </b></summary>
<div markdown="1">
    
#### ë¬¸ì œ
ì„œë²„ëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ì•„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ìš”ì²­ì—ëŠ” ê²€ì¦ë˜ì§€ ì•Šì€ ì˜ëª»ëœ ê°’ì´ ë“¤ì–´ì˜¬ ìˆ˜ ìˆìœ¼ë©°, ì´ë¡œ ì¸í•´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìˆ˜í–‰ ì¤‘ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì…ë ¥ê°’ì„ ì œëŒ€ë¡œ ê²€ì¦í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ê²€ì¦ë˜ì§€ ì•Šì€ ê°’ìœ¼ë¡œ DBì— ì ‘ê·¼í•˜ë©´ ì˜ˆì™¸ê°€ ë°œìƒí•  ìˆ˜ ìˆìœ¼ë©°, ì´ë¥¼ ë¯¸ë¦¬ ë°©ì§€í•¨ìœ¼ë¡œì¨ DB ì ‘ê·¼ì„ ìµœì†Œí™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë˜í•œ ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ í†µí•´ ì¼ê´€ëœ í˜•ì‹ìœ¼ë¡œ ì‘ë‹µì„ ì œê³µí•¨ìœ¼ë¡œì¨ í´ë¼ì´ì–¸íŠ¸ëŠ” ë¡œì§ ìˆ˜ì • ì—†ì´ë„ ì˜ˆì™¸ ìƒí™©ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### í•´ê²°
**ì¼ê´€ëœ ì‘ë‹µ í˜•ì‹**

![](https://file.notion.so/f/s/617d6afc-d1df-48be-a68a-a7c5ff1dc5da/Untitled.png?id=86054929-8a90-4f81-a134-a20496df794d&table=block&spaceId=92733449-5700-47a6-a223-50f1b43b5171&expirationTimestamp=1690372800000&signature=DuIMvTqRuc5o02nVKOTTNQWxRfxg0uLH5fgNwC6_Rhk&downloadName=Untitled.png)

ì‘ë‹µ í˜•ì‹ì€ ìœ„ì™€ ê°™ì€ í˜•ì‹ì„ ê°–ìŠµë‹ˆë‹¤.
-   `code` : ë°œìƒí•œ ì—ëŸ¬ì— ëŒ€í•œ ì •ë³´ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì½”ë“œ
-   `message` : ì—ëŸ¬ì— ëŒ€í•œ ì„¸ë¶€ ë©”ì„¸ì§€
-   `inputErrors` : ì…ë ¥ê°’ ê²€ì¦ ì˜ˆì™¸ ì‹œ ì„¸ë¶€ ì •ë³´
    -   `message` : ê²€ì¦ ì—ëŸ¬ì— ëŒ€í•œ ë©”ì„¸ì§€
    -   `field` : ê²€ì¦ ì—ëŸ¬ê°€ ë°œìƒí•œ í•„ë“œ

ì˜ˆì™¸ ì²˜ë¦¬ëŠ” `ControllerAdvice`ë¥¼ ì‚¬ìš©í•˜ì—¬ í•˜ë‚˜ì˜ í´ë˜ìŠ¤ì—ì„œ í•¸ë“¤ë§ í•˜ì˜€ìŠµë‹ˆë‹¤.
```java
@RestControllerAdvice
public class GlobalExceptionHandler {

	// ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸ ë°œìƒ ì‹œ
	@ExceptionHandler(value = BusinessException.class)
	protected ResponseEntity<ErrorResponse> handleBusinessException(BusinessException exception) {
		ErrorCode errorCode = exception.getErrorCode();

		return ResponseEntity
				.status(HttpStatus.valueOf(errorCode.getStatus()))
				.body(ErrorResponse.basic(errorCode));
	}

	// @RequestBody + @Validë¡œ ë°”ì¸ë”© ì—ëŸ¬ ë°œìƒ ì‹œ 
	@ExceptionHandler(value = MethodArgumentNotValidException.class)
	protected ResponseEntity<ErrorResponse> handleValidationException(MethodArgumentNotValidException exception) {
		return ResponseEntity
				.status(HttpStatus.BAD_REQUEST)
				.body(ErrorResponse.input(exception.getFieldErrors()));
	}

	// @ModelAttribute + @Validë¡œ ë°”ì¸ë”© ì—ëŸ¬ ë°œìƒ ì‹œ 
	@ExceptionHandler(value = BindException.class)
	protected ResponseEntity<ErrorResponse> handleValidationException(BindException exception) {
		return ResponseEntity
				.status(HttpStatus.BAD_REQUEST)
				.body(ErrorResponse.input(exception.getFieldErrors()));
	}
	
	// URL Parameter + @Validatedë¡œ ë°”ì¸ë”© ì—ëŸ¬ ë°œìƒ ì‹œ
	@ExceptionHandler(value = ConstraintViolationException.class)
	protected ResponseEntity<ErrorResponse> handleValidationException(ConstraintViolationException exception) {
		return ResponseEntity
				.status(HttpStatus.BAD_REQUEST)
				.body(ErrorResponse.input(exception.getConstraintViolations()));
	}
	
	// URL Parameter ë°”ì¸ë”© ì‹œ íƒ€ì…ì´ ì¼ì¹˜ í•˜ì§€ ì•Šì„ ê²½ìš°
	@ExceptionHandler(value = MethodArgumentTypeMismatchException.class)
	protected ResponseEntity<ErrorResponse> handleValidationException(MethodArgumentTypeMismatchException exception) {
		return ResponseEntity
				.status(HttpStatus.BAD_REQUEST)
				.body(ErrorResponse.input(exception.getErrorCode(), exception.getParameter().getParameterName()));
	}

	// Query Parameterì— ê°’ì´ ì „ë‹¬ë˜ì§€ ì•Šì€ ê²½ìš°
	@ExceptionHandler(value = MissingServletRequestParameterException.class)
	protected ResponseEntity<ErrorResponse> handleMissingServletRequestParameterException(MissingServletRequestParameterException exception) {
		return ResponseEntity
				.status(HttpStatus.BAD_REQUEST)
				.body(ErrorResponse.input(exception.getMessage(), exception.getParameterName()));
	}
	
	// URLì€ ì¡´ì¬í•˜ì§€ë§Œ ëŒ€ì‘ë˜ëŠ” HTTP ë©”ì†Œë“œê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš° 
	@ExceptionHandler(value = HttpRequestMethodNotSupportedException.class)
	protected ResponseEntity<ErrorResponse> handleHttpRequestMethodNotSupportedException(HttpRequestMethodNotSupportedException exception) {
		return ResponseEntity
				.status(HttpStatus.BAD_REQUEST)
				.body(ErrorResponse.basic(METHOD_NOT_ALLOWED));
	}

	// ë‚˜ë¨¸ì§€ ì˜ˆì™¸ ë°œìƒ ì‹œ
	@ExceptionHandler(value = Exception.class)
	protected ResponseEntity<ErrorResponse> handleException(Exception exception) {
		return ResponseEntity
				.status(HttpStatus.INTERNAL_SERVER_ERROR)
				.body(ErrorResponse.basic(INTERNAL_SERVER_ERROR));
	}
}
```
#### ê²°ê³¼
1. ì…ë ¥ê°’ ê²€ì¦ ì˜ˆì™¸ ë°œìƒ ì‹œ

![](https://file.notion.so/f/s/23664025-d310-4a8c-a48d-ad90b279b394/Untitled.png?id=6eb7d68d-f1d3-4e2c-86b2-b1e302a09c6c&table=block&spaceId=92733449-5700-47a6-a223-50f1b43b5171&expirationTimestamp=1690372800000&signature=EhK_43P11kMzqrWZKveBOPzg-X99Keckr1NVw6cfptc&downloadName=Untitled.png)


2. ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ˆì™¸ ë°œìƒ ì‹œ

![](https://file.notion.so/f/s/bb4416ef-4eed-4e62-a822-fa43cbfa82e2/Untitled.png?id=72a7b76d-cda0-404d-b407-869dff48e86a&table=block&spaceId=92733449-5700-47a6-a223-50f1b43b5171&expirationTimestamp=1690372800000&signature=CA6fhpDTPr86ciLdJQlsdkx8ewnADk69rHYNSvJkTD8&downloadName=Untitled.png)

</div>
</details>
<br>

###  Spring Rest Docs + Swagger í†µí•© ë¬¸ì„œí™”
**ìš”ì•½: Spring Rest Docsì˜ ë¬¸ì„œ ì‹ ë¢°ì„±, Swaggerì˜ ê°€ë…ì„± ì¢‹ì€ UIì˜ ì¥ì ì„ ì‚´ë ¤ API ë¬¸ì„œí™”**
<details>
<summary> <b> í™•ì¸ </b></summary>
<div markdown="1">

#### ë¬¸ì œ

API ë¬¸ì„œí™”ë¥¼ ìœ„í•´ ë‹¤ìŒ ë‘ ê°€ì§€ ì„ íƒì§€ê°€ ì¡´ì¬í–ˆìŠµë‹ˆë‹¤.
- Swagger
- Spring Rest Docs

SwaggerëŠ” ì–´ë…¸í…Œì´ì…˜ì„ ê¸°ë°˜ìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ ì ìš©í•  ìˆ˜ ìˆê³  ë¬¸ì„œí™”ëœ UIê°€ ê°€ë…ì„±ì´ ì¢‹ë‹¤ëŠ” ì¥ì ì´ ìˆì§€ë§Œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë¬¸ì„œí™” ì½”ë“œê°€ ì„ì´ê²Œ ë˜ê³ , í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ë¬¸ì„œí™”ê°€ ê°€ëŠ¥í•˜ì—¬ ë¬¸ì„œì˜ ì •í™•ì„±ì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆë‹¤ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.

Spring Rest DocsëŠ” í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— API ë¬¸ì„œê°€ ì‹ ë¢°ì„±ì´ ìˆê³ , ë¹„ì¦ˆë‹ˆìŠ¤ ì½”ë“œì™€ ë³„ê°œë¡œ ë¬¸ì„œí™” ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸° ë•Œë¬¸ì— ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë¬¸ì„œí™” ì½”ë“œê°€ ì„ì´ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì¥ì ì´ ìˆì§€ë§Œ, ìµœì¢… ë¬¸ì„œë¥¼ ê°œë°œìê°€ ì§ì ‘ ì‘ì„±í•´ì¤˜ì•¼ í•˜ê³  ê°œì¸ì ìœ¼ë¡œ ë¬¸ì„œ UIì˜ ê°€ë…ì„±ì´ ë–¨ì–´ì§„ë‹¤ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤.

#### í•´ê²°
Swaggerì™€ Spring Rest Docsì˜ ì¥ì ë§Œ ì ìš©í•˜ì—¬ Spring Rest Docs ê¸°ë°˜ì˜ ì½”ë“œë¡œ ë¬¸ì„œí™”ë¥¼ í•˜ê³  í•´ë‹¹ ë¬¸ì„œë¥¼ Swagger UIë¡œ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

#### ê²°ê³¼
```java
@Test
@DisplayName("íšŒì›ê°€ì… ì‹œ ì´ë©”ì¼ ì¤‘ë³µìœ¼ë¡œ ì‹¤íŒ¨í•œë‹¤.")
void signUpDuplicatedEmailFail() throws Exception {
		
    // í…ŒìŠ¤íŠ¸ ì½”ë“œ ìƒëµ

    // docs
    resultActions.andDo(
        document("ì´ë©”ì¼ ì¤‘ë³µìœ¼ë¡œ íšŒì›ê°€ì… ì‹¤íŒ¨",
	    ResourceSnippetParameters.builder()
	        .tag(SIGNUP_TAG)
		.requestSchema(Schema.schema(SIGNUP_REQ_SCHEMA))
		.responseSchema(Schema.schema(COMMON_EX_OBJ_SCHEMA)),
		    preprocessRequest(prettyPrint()),
		    preprocessResponse(prettyPrint()),
		    requestFields(
		        fieldWithPath(SIGNUP_LOGIN_ID_REQ_FIELD).type(JsonFieldType.STRING).description(SIGNUP_LOGIN_ID_REQ_DESCRIPTION),
			fieldWithPath(SIGNUP_NAME_REQ_FIELD).type(JsonFieldType.STRING).description(SIGNUP_NAME_REQ_DESCRIPTION),
			fieldWithPath(SIGNUP_EMAIL_REQ_FIELD).type(JsonFieldType.STRING).description(SIGNUP_EMAIL_REQ_DESCRIPTION),
			fieldWithPath(SIGNUP_NICKNAME_REQ_FIELD).type(JsonFieldType.STRING).description(SIGNUP_NICKNAME_REQ_DESCRIPTION),
			fieldWithPath(SIGNUP_PASSWORD_REQ_FIELD).type(JsonFieldType.STRING).description(SIGNUP_PASSWORD_REQ_DESCRIPTION)
			),
		    responseFields(
		        fieldWithPath(ERROR_MESSAGE_FIELD).type(JsonFieldType.STRING).description(ERROR_MESSAGE_DESCRIPTION),
			fieldWithPath(ERROR_CODE_FIELD).type(JsonFieldType.STRING).description(ERROR_CODE_DESCRIPTION),
			fieldWithPath(INPUT_ERROR_INFOS_FIELD).type(JsonFieldType.NULL).description(INPUT_ERROR_INFOS_DESCRIPTION)
		)
	    )
        );
    }
 ```
API ë¬¸ì„œí™”ë¥¼ ìœ„í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
  
![](https://blog.kakaocdn.net/dn/b3pTZs/btso12ewOYU/8EdbHVRZ3dAiGojgoX5IA0/img.png)

Swagger UIë¡œ API ë¬¸ì„œê°€ ìƒì„±ë©ë‹ˆë‹¤.
</div>
</details>